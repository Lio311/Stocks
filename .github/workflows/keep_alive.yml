name: Keep Streamlit Apps Alive (with Selenium)

on:
  schedule:
    # הרצה כל 45 דקות
    - cron: '*/45 * * * *'
  workflow_dispatch:
    # מאפשר הרצה ידנית לצרכי בדיקה

jobs:
  wake-apps-matrix:
    runs-on: ubuntu-latest
    
    # שימוש ב-Matrix כדי להריץ את אותם צעדים עבור כל URL
    strategy:
      # אם אחד נכשל, אל תבטל את השאר
      fail-fast: false
      matrix:
        app_url:
          - "https://liostocks.streamlit.app"
          - "https://fourieropticssimulator.streamlit.app"
          - "https://rppgvitalsanalyzer.streamlit.app"
          - "https://gaitanalysis3.streamlit.app"
          - "https://ecgarrhythmiasimulator.streamlit.app"
          - "https://ringsimulator.streamlit.app"
          - "https://physiosimulator.streamlit.app"
          - "https://smartriagegantt.streamlit.app"

    steps:
      # 1. שכפול ה-Repo (כדי לקבל גישה לסקריפט הפייתון)
      - name: Check out repository
        uses: actions/checkout@v4

      # 2. התקנת פייתון
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. התקנת דפדפן כרום ודרייברים (חיוני לסלניום)
      - name: Install system dependencies (Chrome Browser)
        run: |
          sudo apt-get update
          sudo apt-get install -y chromium-browser chromium-chromedriver

      # 4. התקנת ספריות פייתון (סלניום)
      - name: Install Python dependencies
        run: pip install selenium

      # 5. הרצת סקריפט הפייתון עם ה-URL הנוכחי מה-Matrix
      - name: Run wake-up script for ${{ matrix.app_url }}
        run: python wake_app.py ${{ matrix.app_url }}
